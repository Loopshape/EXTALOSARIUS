(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const u=document.getElementById("gl"),t=u.getContext("webgl");t||alert("WebGL not supported");function P(){u.width=u.clientWidth*devicePixelRatio,u.height=u.clientHeight*devicePixelRatio,t.viewport(0,0,u.width,u.height)}window.addEventListener("resize",P);P();function z(r=1,o=24,e=48){const c=[];for(let s=0;s<=o;s++){const n=s/o*Math.PI;for(let i=0;i<=e;i++){const a=i/e*2*Math.PI,d=r*Math.sin(n)*Math.cos(a),l=r*Math.cos(n),m=r*Math.sin(n)*Math.sin(a);c.push(d,l,m)}}return new Float32Array(c)}const U=z(.92,36,72),H="attribute vec3 pos; uniform mat4 mvp; uniform float pointSize; void main(){ gl_Position = mvp * vec4(pos,1.0); gl_PointSize = pointSize; }",Y="precision mediump float; uniform vec3 color; void main(){ float d = length(gl_PointCoord - vec2(0.5)); if(d>0.5) discard; gl_FragColor = vec4(color,1.0); }",V="attribute vec3 pos; uniform mat4 mvp; void main(){ gl_Position = mvp * vec4(pos,1.0); }",q="precision mediump float; uniform vec3 color; void main(){ gl_FragColor = vec4(color,1.0); }";function x(r,o){const e=t.createShader(r);if(t.shaderSource(e,o),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw t.getShaderInfoLog(e);return e}function N(r,o){const e=t.createProgram();if(t.attachShader(e,x(t.VERTEX_SHADER,r)),t.attachShader(e,x(t.FRAGMENT_SHADER,o)),t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS))throw t.getProgramInfoLog(e);return e}const h=N(H,Y),y=N(V,q),b=t.getAttribLocation(h,"pos"),w=t.getUniformLocation(h,"mvp"),L=t.getUniformLocation(h,"color"),B=t.getUniformLocation(h,"pointSize"),A=t.getAttribLocation(y,"pos"),I=t.getUniformLocation(y,"mvp"),F=t.getUniformLocation(y,"color"),k=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,k);t.bufferData(t.ARRAY_BUFFER,U,t.STATIC_DRAW);function J(r,o,e,c){const s=1/Math.tan(r/2),n=1/(e-c),i=new Float32Array(16);return i[0]=s/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(c+e)*n,i[11]=-1,i[12]=0,i[13]=0,i[14]=2*c*e*n,i[15]=0,i}function S(){const r=new Float32Array(16);return r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function E(r,o){const e=new Float32Array(16);for(let c=0;c<4;c++)for(let s=0;s<4;s++){let n=0;for(let i=0;i<4;i++)n+=r[i*4+s]*o[c*4+i];e[c*4+s]=n}return e}function G(r,o,e){const c=S();return c[12]=r,c[13]=o,c[14]=e,c}function W(r){const o=Math.cos(r),e=Math.sin(r),c=S();return c[0]=o,c[2]=e,c[8]=-e,c[10]=o,c}function K(r,o,e,c){const s=r[0],n=r[1],i=r[2],a=o[0]*s+o[4]*n+o[8]*i+o[12],d=o[1]*s+o[5]*n+o[9]*i+o[13],l=o[3]*s+o[7]*n+o[11]*i+o[15];if(l===0)return[0,0,-1];const m=a/l,p=d/l;return[(m*.5+.5)*e,(1-(p*.5+.5))*c,l]}const M=["predictor","adviser","coordinator","constellator","marketer","navigator","communicator","doctor"],_=["cube","core","loop","wave","line","coin","code","work"];let f=[];function j(r){document.querySelectorAll(".ufo-label").forEach(e=>e.remove()),f=[];const o=8;for(let e=0;e<o;e++){const c=e/o*Math.PI*2,s=1.35,n=c,i=_[e%_.length],a=M[e%M.length],d=e/o,l=X(d,.9,.95),m=[Math.cos(n)*s,0,Math.sin(n)*s],p=document.createElement("div");p.className="ufo-label",p.innerText=`${a} â€¢ ${i}`,document.body.appendChild(p),f.push({id:e,name:a,model:i,orbitRadius:s,orbitPhase:n,color:l,label:p,position:m,trail:[]})}Q()}function X(r,o,e){const c=Math.floor(r*6),s=r*6-c,n=e*(1-o),i=e*(1-s*o),a=e*(1-(1-s)*o);let d,l,m;switch(c%6){case 0:d=e,l=a,m=n;break;case 1:d=i,l=e,m=n;break;case 2:d=n,l=e,m=a;break;case 3:d=n,l=i,m=e;break;case 4:d=a,l=n,m=e;break;case 5:d=e,l=n,m=i;break}return[d,l,m]}function Q(){const r=document.getElementById("agents");r.innerHTML="",f.forEach(o=>{const e=document.createElement("div");e.className="agent",e.innerHTML=`<strong>${o.name}</strong><small>${o.model}</small><div style="font-size:12px;margin-top:6px">orbit r=${o.orbitRadius.toFixed(2)}</div>`,r.appendChild(e)})}function v(r){const o=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),o}const R=[];(function(){for(let o=0;o<7;o++){const e=[],c=(o-3)*.18;for(let s=-3;s<=3;s+=.2){const n=-2+s*.9,i=-1.5+c+Math.sin(s*.6)*.15,a=-2+s*.4;e.push(n,i,a)}R.push(new Float32Array(e))}})();const Z=R.map(r=>v(r));let T=0;const ee=.002;function $(){P(),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST);const r=u.width/u.height,o=J(Math.PI/4,r,.1,100),e=G(0,0,-6),c=E(W(T*.4),S()),s=E(o,E(e,c));t.useProgram(h),t.bindBuffer(t.ARRAY_BUFFER,k),t.enableVertexAttribArray(b),t.vertexAttribPointer(b,3,t.FLOAT,!1,0,0),t.uniformMatrix4fv(w,!1,s),t.uniform3f(L,.12,.45,.82),t.uniform1f(B,1.8*devicePixelRatio),t.drawArrays(t.POINTS,0,U.length/3),t.useProgram(y),t.uniformMatrix4fv(I,!1,s),t.uniform3f(F,.25,.1,.7),Z.forEach((n,i)=>{t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(A),t.vertexAttribPointer(A,3,t.FLOAT,!1,0,0),t.drawArrays(t.LINE_STRIP,0,R[i].length/3)}),t.useProgram(h),t.uniformMatrix4fv(w,!1,s),f.forEach((n,i)=>{n.orbitPhase+=ee*(1+i*.02);const a=Math.cos(n.orbitPhase)*n.orbitRadius,d=Math.sin(n.orbitPhase*.4)*.18,l=Math.sin(n.orbitPhase)*n.orbitRadius;n.position=[a,d,l],n.trail.unshift([a*.9,d*.9,l*.9]),n.trail.length>128&&n.trail.pop();const m=new Float32Array(n.position),p=v(m);t.bindBuffer(t.ARRAY_BUFFER,p),t.enableVertexAttribArray(b),t.vertexAttribPointer(b,3,t.FLOAT,!1,0,0),t.uniform3f(L,n.color[0],n.color[1],n.color[2]),t.uniform1f(B,12*devicePixelRatio),t.drawArrays(t.POINTS,0,1),t.deleteBuffer(p)}),t.useProgram(y),t.uniformMatrix4fv(I,!1,s),f.forEach((n,i)=>{if(n.trail.length<2)return;const a=new Float32Array(n.trail.length*3);for(let l=0;l<n.trail.length;l++)a[l*3]=n.trail[l][0],a[l*3+1]=n.trail[l][1],a[l*3+2]=n.trail[l][2];const d=v(a);t.bindBuffer(t.ARRAY_BUFFER,d),t.enableVertexAttribArray(A),t.vertexAttribPointer(A,3,t.FLOAT,!1,0,0),t.uniform3f(F,n.color[0]*.9,n.color[1]*.9,n.color[2]*.9),t.drawArrays(t.LINE_STRIP,0,n.trail.length),t.deleteBuffer(d)}),f.forEach(n=>{const i=K(n.position,s,u.width,u.height),a=n.label;a&&(i[2]<0?a.style.display="none":(a.style.display="block",a.style.left=i[0]/devicePixelRatio+"px",a.style.top=i[1]/devicePixelRatio+"px"))}),T+=.003,requestAnimationFrame($)}function g(r){const o=document.getElementById("log");o.innerText="["+new Date().toISOString()+"] "+r+`
`+o.innerText}async function C(r){const o=new TextEncoder().encode(r),e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(c=>c.toString(16).padStart(2,"0")).join("")}document.getElementById("genesisBtn");const D=document.getElementById("genesisHash");gensisBtn.addEventListener("click",async()=>{const r=document.getElementById("genesisPrompt").value,o=Date.now().toString(),e=await C(r+"|"+o);D.value=e,g("Generated genesis: "+e.slice(0,16)),j()});document.getElementById("probeModels").addEventListener("click",async()=>{try{const o=await(await fetch("/api/models")).json();g("Ollama models: "+(o.models||o).length||JSON.stringify(o))}catch(r){g("Probe failed: "+r.message)}});document.getElementById("runCycle").addEventListener("click",async()=>{await te()});async function te(){const r=D.value||await C(document.getElementById("genesisPrompt").value+"|"+Date.now()),o=`GENESIS:${r}
Observe vector and submit short report.`,e=f.map((a,d)=>oe(a,o)),c=await Promise.all(e),s=c.map(a=>ne(a.text)),n=s.indexOf(Math.min(...s));g("Cycle done. Best agent: "+f[n].name+" ("+f[n].model+") entropy="+s[n].toFixed(3)),document.getElementById("agentOutput").innerText=c.map((a,d)=>`${f[d].name}@${f[d].model}: ${a.text.slice(0,200)}`).join(`

`);const i=JSON.parse(localStorage.getItem("ufo_mem")||"[]");i.push({gen:r,results:c,entropies:s,ts:Date.now()}),localStorage.setItem("ufo_mem",JSON.stringify(i.slice(-200))),re(s)}async function oe(r,o){const e=document.getElementById("ollamaUrl").value,c=r.name,s=r.model,n=`${o}
Role: ${c}
Model: ${s}
Task: produce short vector observation and a numeric score`;if(!e)return{text:O(n)};try{const a=await(await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:s,prompt:n,max_tokens:120})})).json();return{text:(a.output||a.result||JSON.stringify(a)).toString()}}catch{return{text:O(n)}}}function O(r){const e=Array.from(new TextEncoder().encode(r)).reduce((c,s)=>(c*31+s)%1000000007,7)%100/100;return`SIMULATED RESPONSE score=${e.toFixed(2)} | summary: agent observed vector magnitude ${(e*10).toFixed(2)}`}function ne(r){const o={};for(const s of r)o[s]=(o[s]||0)+1;let e=0;const c=r.length;for(const s in o){const n=o[s]/c;e-=n*Math.log2(n)}return e}function re(r){const o=document.getElementById("stats");o.innerText=`entropies:
`+r.map((e,c)=>`${f[c].name.padEnd(12)} ${e.toFixed(3)}
`).join("")}document.getElementById("saveMemory").addEventListener("click",()=>{const r=localStorage.getItem("ufo_mem")||"[]",o=new Blob([r],{type:"application/json"}),e=document.createElement("a");e.href=URL.createObjectURL(o),e.download="ufo_memory.json",e.click(),g("Memory exported")});document.getElementById("reloopMemory").addEventListener("click",()=>{const r=JSON.parse(localStorage.getItem("ufo_mem")||"[]");if(!r.length){g("no memory");return}const o=r.map(e=>({m:e,score:Math.min(...e.entropies)})).sort((e,c)=>e.score-c.score).slice(0,6);g("Re-looped top strategies: "+o.map(e=>new Date(e.m.ts).toISOString()).join(", "))});j();$();
